<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Linux on To be the Light - Steve Lemuel</title><link>https://wlemuel.github.io/categories/linux/</link><description>Recent content in Linux on To be the Light - Steve Lemuel</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Sun, 10 May 2020 22:55:00 +0800</lastBuildDate><atom:link href="https://wlemuel.github.io/categories/linux/index.xml" rel="self" type="application/rss+xml"/><item><title>Tracking down where disk space has gone on Linux?</title><link>https://wlemuel.github.io/2020/05/10/tracking-down-where-disk-space-has-gone-on-linux/</link><pubDate>Sun, 10 May 2020 22:55:00 +0800</pubDate><guid>https://wlemuel.github.io/2020/05/10/tracking-down-where-disk-space-has-gone-on-linux/</guid><description>&lt;p>One of my linux server shows that it has low disk usage right now, so I decide to
free disk space by deleting some useless files, including expired logs. At first
I connect to remote linux server with &lt;strong>ssh&lt;/strong>, and then do the following steps:&lt;/p>
&lt;h2 id="1-dot-show-the-disk-space-information-dot">1. Show the disk space information.&lt;/h2>
&lt;div class="highlight">&lt;pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">df -h
&lt;span style="color:#007f7f"># Filesystem Size Used Avail Use% Mounted on&lt;/span>
&lt;span style="color:#007f7f"># /dev/vda1 40G 33G 4.5G 89% /&lt;/span>
&lt;span style="color:#007f7f"># devtmpfs 1.9G 0 1.9G 0% /dev&lt;/span>
&lt;span style="color:#007f7f"># tmpfs 1.9G 0 1.9G 0% /dev/shm&lt;/span>
&lt;span style="color:#007f7f"># tmpfs 1.9G 484K 1.9G 1% /run&lt;/span>
&lt;span style="color:#007f7f"># tmpfs 1.9G 0 1.9G 0% /sys/fs/cgroup&lt;/span>
&lt;span style="color:#007f7f"># tmpfs 380M 0 380M 0% /run/user/1005&lt;/span>
&lt;span style="color:#007f7f"># tmpfs 380M 0 380M 0% /run/user/0&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>It shows that there is only 4.5G left in this server, so I will start to delete
some files.&lt;/p>
&lt;h2 id="2-dot-find-out-the-biggest-files-and-directories-dot">2. Find out the biggest files and directories.&lt;/h2>
&lt;div class="highlight">&lt;pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">du -Sh / | sort -rh | head -n &lt;span style="color:#ff0;font-weight:bold">15&lt;/span>
&lt;span style="color:#007f7f"># du: cannot access ‘/proc/13476/task/13476/fd/4’: No such file or directory&lt;/span>
&lt;span style="color:#007f7f"># du: cannot access ‘/proc/13476/task/13476/fdinfo/4’: No such file or directory&lt;/span>
&lt;span style="color:#007f7f"># du: cannot access ‘/proc/13476/fd/4’: No such file or directory&lt;/span>
&lt;span style="color:#007f7f"># du: cannot access ‘/proc/13476/fdinfo/4’: No such file or directory&lt;/span>
&lt;span style="color:#007f7f"># 1.3G /usr/local/mysql/bin&lt;/span>
&lt;span style="color:#007f7f"># 1008M /usr/local/mysql/lib&lt;/span>
&lt;span style="color:#007f7f"># 889M /data/wyvern/logs/celery&lt;/span>
&lt;span style="color:#007f7f"># 686M /data/wyvern/qcard&lt;/span>
&lt;span style="color:#007f7f"># 622M /root/oneinstack/src&lt;/span>
&lt;span style="color:#007f7f"># 539M /data/wyvern/logs/gunicorn&lt;/span>
&lt;span style="color:#007f7f"># 497M /var/log/journal/a9fe31fd96c841a5a16f9c54110b66cc&lt;/span>
&lt;span style="color:#007f7f"># 180M /data/wyvern&lt;/span>
&lt;span style="color:#007f7f"># 174M /boot&lt;/span>
&lt;span style="color:#007f7f"># 121M /data/mysql&lt;/span>
&lt;span style="color:#007f7f"># 114M /usr/lib64&lt;/span>
&lt;span style="color:#007f7f"># 114M /usr/bin&lt;/span>
&lt;span style="color:#007f7f"># 102M /usr/lib/locale&lt;/span>
&lt;span style="color:#007f7f"># 86M /usr/java/jdk1.7.0_80/jre/lib&lt;/span>
&lt;span style="color:#007f7f"># 76M /usr/local/cloudmonitor/jre/lib/i386&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>What&amp;rsquo;s wrong ????&lt;/p>
&lt;p>There seems no big files or directories. (It&amp;rsquo;s impossible according to my experience!!!)&lt;/p>
&lt;h2 id="3-dot-find-out-the-data-that-was-deleted-but-not-released-by-filesystem-dot">3. Find out the data that was deleted but not released by FileSystem.&lt;/h2>
&lt;div class="highlight">&lt;pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">lsof | grep &lt;span style="color:#0ff;font-weight:bold">&amp;#39;(deleted)&amp;#39;&lt;/span>
&lt;span style="color:#007f7f"># gunicorn 21228 root 7u REG 253,1 0 665601 /tmp/wgunicorn-AcuOTP (deleted)&lt;/span>
&lt;span style="color:#007f7f"># gunicorn 21230 root 7u REG 253,1 0 665590 /tmp/wgunicorn-ddaaqtnp (deleted)&lt;/span>
&lt;span style="color:#007f7f"># gunicorn 21230 root 8u REG 253,1 0 665593 /tmp/wgunicorn-lpv_r06g (deleted)&lt;/span>
&lt;span style="color:#007f7f"># gunicorn 21230 root 9u REG 253,1 0 665596 /tmp/wgunicorn-kqmta562 (deleted)&lt;/span>
&lt;span style="color:#007f7f"># gunicorn 21230 root 10u REG 253,1 0 665603 /tmp/wgunicorn-fnusav1e (deleted)&lt;/span>
&lt;span style="color:#007f7f"># nginx 21495 root 5w REG 253,1 26287067976 1709016 /var/log/nginx/access.log (deleted)&lt;/span>
&lt;span style="color:#007f7f"># nginx 21496 root 5w REG 253,1 26287067976 1709016 /var/log/nginx/access.log (deleted)&lt;/span>
&lt;span style="color:#007f7f"># nginx 21497 root 5w REG 253,1 26287067976 1709016 /var/log/nginx/access.log (deleted)&lt;/span>
&lt;span style="color:#007f7f"># gunicorn 27996 root 6u REG 253,1 0 665594 /tmp/wgunicorn-7CgVKM (deleted)&lt;/span>
&lt;span style="color:#007f7f"># gunicorn 27996 root 7u REG 253,1 0 665601 /tmp/wgunicorn-AcuOTP (deleted)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>It shows that some nginx logs that were not released correctly by the system.&lt;/p>
&lt;h2 id="4-dot-restart-nginx-process-to-release-the-logs-dot">4. Restart nginx process to release the logs.&lt;/h2>
&lt;div class="highlight">&lt;pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">systemctl restart nginx
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="5-dot-confirm-the-storage-is-released-dot">5. Confirm the storage is released.&lt;/h2>
&lt;div class="highlight">&lt;pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">df -h
&lt;span style="color:#007f7f"># Filesystem Size Used Avail Use% Mounted on&lt;/span>
&lt;span style="color:#007f7f"># /dev/vda1 40G 8.4G 29G 23% /&lt;/span>
&lt;span style="color:#007f7f"># devtmpfs 1.9G 0 1.9G 0% /dev&lt;/span>
&lt;span style="color:#007f7f"># tmpfs 1.9G 0 1.9G 0% /dev/shm&lt;/span>
&lt;span style="color:#007f7f"># tmpfs 1.9G 484K 1.9G 1% /run&lt;/span>
&lt;span style="color:#007f7f"># tmpfs 1.9G 0 1.9G 0% /sys/fs/cgroup&lt;/span>
&lt;span style="color:#007f7f"># tmpfs 380M 0 380M 0% /run/user/1005&lt;/span>
&lt;span style="color:#007f7f"># tmpfs 380M 0 380M 0% /run/user/0&lt;/span>
&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>