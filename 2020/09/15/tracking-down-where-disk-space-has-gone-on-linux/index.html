<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=color-scheme content="light dark"><meta name=author content="Steve Lemuel"><meta name=description content="As a Linux administrator, I recently encountered a situation where one of my servers was displaying low disk utilization. To rectify the issue, I decided to employ a strategy of decluttering by removing any redundant files, including expired logs.
In order to accomplish this task, I first established a secure remote connection to the server using ssh. Then, I embarked on the following series of steps to reclaim the precious disk space and restore optimal performance to my Linux system."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Tracking down where disk space has gone on Linux"><meta name=twitter:description content="As a Linux administrator, I recently encountered a situation where one of my servers was displaying low disk utilization. To rectify the issue, I decided to employ a strategy of decluttering by removing any redundant files, including expired logs.
In order to accomplish this task, I first established a secure remote connection to the server using ssh. Then, I embarked on the following series of steps to reclaim the precious disk space and restore optimal performance to my Linux system."><meta property="og:title" content="Tracking down where disk space has gone on Linux"><meta property="og:description" content="As a Linux administrator, I recently encountered a situation where one of my servers was displaying low disk utilization. To rectify the issue, I decided to employ a strategy of decluttering by removing any redundant files, including expired logs.
In order to accomplish this task, I first established a secure remote connection to the server using ssh. Then, I embarked on the following series of steps to reclaim the precious disk space and restore optimal performance to my Linux system."><meta property="og:type" content="article"><meta property="og:url" content="https://wlemuel.github.io/2020/09/15/tracking-down-where-disk-space-has-gone-on-linux/"><meta property="article:section" content="posts"><meta property="article:modified_time" content="2020-09-15T18:42:33+08:00"><meta property="og:see_also" content="https://wlemuel.github.io/2020/03/09/make-teamviewer-work-on-arch-linux/"><title>Tracking down where disk space has gone on Linux · To be the Light</title><link rel=canonical href=https://wlemuel.github.io/2020/09/15/tracking-down-where-disk-space-has-gone-on-linux/><link rel=preload href="https://wlemuel.github.io/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://wlemuel.github.io/css/coder.min.93c41bf1e522f85ecda7355985f09000f71fc1d64dda9f74051b0fa06210e93f.css integrity="sha256-k8Qb8eUi+F7NpzVZhfCQAPcfwdZN2p90BRsPoGIQ6T8=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://wlemuel.github.io/css/coder-dark.min.f37febc669ce189201c1918fac1948a254686c8d366a312c2d72b2bb71ad97d1.css integrity="sha256-83/rxmnOGJIBwZGPrBlIolRobI02ajEsLXKyu3Gtl9E=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=https://wlemuel.github.io/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://wlemuel.github.io/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=https://wlemuel.github.io/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=https://wlemuel.github.io/images/apple-touch-icon.png><script defer src=https://twemoji.maxcdn.com/v/13.0.2/twemoji.min.js integrity=sha384-wyB/MspSJ/r2bT2kCj44qtsYRYlpzO2oAPhRj5myrWD63dt6qWv4x8AZe7Fl3K3b crossorigin=anonymous></script><meta name=generator content="Hugo 0.111.0"><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?0356ab0fd3c3575c003b18dd9091266c",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-166054460-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-166054460-1")</script></head><body class="preload-transitions colorscheme-auto" onload=twemoji.parse(document.body)><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://wlemuel.github.io/>Home</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://wlemuel.github.io/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://wlemuel.github.io/about/>About</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://wlemuel.github.io/2020/09/15/tracking-down-where-disk-space-has-gone-on-linux/>Tracking down where disk space has gone on Linux</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2020-09-15T18:42:33+08:00>September 15, 2020</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
3-minute read&nbsp;&nbsp;(505 words)</span></div><div class=categories><i class="fa fa-folder" aria-hidden=true></i>
<a href=https://wlemuel.github.io/categories/linux/>Linux</a></div></div></header><div><img src=https://wlemuel.github.io/images/posts/track-down-free-disk-space.png alt="Featured image"><p>As a Linux administrator, I recently encountered a situation where one of my
servers was displaying low disk utilization. To rectify the issue, I decided to
employ a strategy of decluttering by removing any redundant files, including
expired logs.</p><p>In order to accomplish this task, I first established a secure remote connection
to the server using ssh. Then, I embarked on the following series of steps to
reclaim the precious disk space and restore optimal performance to my Linux
system.</p><h2 id=1-dot-show-the-disk-space-information-dot>1. Show the disk space information.
<a class=heading-link href=#1-dot-show-the-disk-space-information-dot><i class="fa fa-link" aria-hidden=true></i></a></h2><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>df -h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007f7f># Filesystem      Size  Used Avail Use% Mounted on</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># /dev/vda1        40G   33G  4.5G  89% /</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># devtmpfs        1.9G     0  1.9G   0% /dev</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># tmpfs           1.9G     0  1.9G   0% /dev/shm</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># tmpfs           1.9G  484K  1.9G   1% /run</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># tmpfs           1.9G     0  1.9G   0% /sys/fs/cgroup</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># tmpfs           380M     0  380M   0% /run/user/1005</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># tmpfs           380M     0  380M   0% /run/user/0</span>
</span></span></code></pre></div><p>I discovered that the server had only 4.5GB of disk space remaining. This
prompted me to take immediate action and commence the process of freeing up disk
space by eliminating unnecessary files.</p><h2 id=2-dot-find-out-the-biggest-files-and-directories-dot>2. Find out the biggest files and directories.
<a class=heading-link href=#2-dot-find-out-the-biggest-files-and-directories-dot><i class="fa fa-link" aria-hidden=true></i></a></h2><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>du -Sh / | sort -rh | head -n <span style=color:#ff0;font-weight:700>15</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007f7f># du: cannot access ‘/proc/13476/task/13476/fd/4’: No such file or directory</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># du: cannot access ‘/proc/13476/task/13476/fdinfo/4’: No such file or directory</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># du: cannot access ‘/proc/13476/fd/4’: No such file or directory</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># du: cannot access ‘/proc/13476/fdinfo/4’: No such file or directory</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># 1.3G    /usr/local/mysql/bin</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># 1008M   /usr/local/mysql/lib</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># 622M    /root/oneinstack/src</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># 497M    /var/log/journal/a9fe31fd96c841a5a16f9c54110b66cc</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># 174M    /boot</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># 121M    /data/mysql</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># 114M    /usr/lib64</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># 114M    /usr/bin</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># 102M    /usr/lib/locale</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># 86M     /usr/java/jdk1.7.0_80/jre/lib</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># 76M     /usr/local/cloudmonitor/jre/lib/i386</span>
</span></span></code></pre></div><p>What&rsquo;s wrong ????</p><p>There seems no big files or directories. (It&rsquo;s impossible according to my experience!!!)</p><h2 id=3-dot-find-out-the-data-that-was-deleted-but-not-released-by-filesystem-dot>3. Find out the data that was deleted but not released by FileSystem.
<a class=heading-link href=#3-dot-find-out-the-data-that-was-deleted-but-not-released-by-filesystem-dot><i class="fa fa-link" aria-hidden=true></i></a></h2><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>lsof | grep <span style=color:#0ff;font-weight:700>&#39;(deleted)&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007f7f># gunicorn  21228            root    7u      REG              253,1           0     665601 /tmp/wgunicorn-AcuOTP (deleted)</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># gunicorn  21230            root    7u      REG              253,1           0     665590 /tmp/wgunicorn-ddaaqtnp (deleted)</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># gunicorn  21230            root    8u      REG              253,1           0     665593 /tmp/wgunicorn-lpv_r06g (deleted)</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># gunicorn  21230            root    9u      REG              253,1           0     665596 /tmp/wgunicorn-kqmta562 (deleted)</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># gunicorn  21230            root   10u      REG              253,1           0     665603 /tmp/wgunicorn-fnusav1e (deleted)</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># nginx     21495            root    5w      REG              253,1 26287067976    1709016 /var/log/nginx/access.log (deleted)</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># nginx     21496            root    5w      REG              253,1 26287067976    1709016 /var/log/nginx/access.log (deleted)</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># nginx     21497            root    5w      REG              253,1 26287067976    1709016 /var/log/nginx/access.log (deleted)</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># gunicorn  27996            root    6u      REG              253,1           0     665594 /tmp/wgunicorn-7CgVKM (deleted)</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># gunicorn  27996            root    7u      REG              253,1           0     665601 /tmp/wgunicorn-AcuOTP (deleted)</span>
</span></span></code></pre></div><p>It shows that the issue was caused by a failure to properly purge nginx logs from the system.</p><h2 id=4-dot-restart-nginx-process-to-release-the-logs-dot>4. Restart nginx process to release the logs.
<a class=heading-link href=#4-dot-restart-nginx-process-to-release-the-logs-dot><i class="fa fa-link" aria-hidden=true></i></a></h2><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>systemctl restart nginx
</span></span></code></pre></div><h2 id=5-dot-confirm-the-storage-is-released-dot>5. Confirm the storage is released.
<a class=heading-link href=#5-dot-confirm-the-storage-is-released-dot><i class="fa fa-link" aria-hidden=true></i></a></h2><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>df -h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007f7f># Filesystem      Size  Used Avail Use% Mounted on</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># /dev/vda1        40G  8.4G   29G  23% /</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># devtmpfs        1.9G     0  1.9G   0% /dev</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># tmpfs           1.9G     0  1.9G   0% /dev/shm</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># tmpfs           1.9G  484K  1.9G   1% /run</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># tmpfs           1.9G     0  1.9G   0% /sys/fs/cgroup</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># tmpfs           380M     0  380M   0% /run/user/1005</span>
</span></span><span style=display:flex><span><span style=color:#007f7f># tmpfs           380M     0  380M   0% /run/user/0</span>
</span></span></code></pre></div></div><footer><section class=see-also><h3 id=see-also-in-linux>See also in Linux
<a class=heading-link href=#see-also-in-linux><i class="fa fa-link" aria-hidden=true></i></a></h3><nav><ul><li><a href=https://wlemuel.github.io/2020/03/09/make-teamviewer-work-on-arch-linux/>Make TeamViewer Work on Arch Linux</a></li></ul></nav></section><script src=https://utteranc.es/client.js repo=wlemuel/wlemuel.github.io issue-term=title label=utterances theme=preferred-color-scheme crossorigin=anonymous async></script></footer></article><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.5/dist/katex.min.css integrity=sha384-L+Gq2Cso/Y2x8fX4wausgiZT8z0QPZz7OqPuz4YqAycQJyrJT9NRLpjFBD6zlOia crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.5/dist/katex.min.js integrity=sha384-z64WtjpyrKFsxox9eI4SI8eM9toXdoYeWb5Qh+8PO+eG54Bv9BZqf9xNhlcLf/sA crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.5/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})'></script></section></div><footer class=footer><section class=container><hr style="border:1px dashed #ccc"><p>Life is short, talk is not cheap.</p>©
2020 -
2023
Steve Lemuel
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=https://wlemuel.github.io/js/coder.min.978ac2219b08e24e68c3f3eada8d99add50d9d997ce3861354b602cc94f75f30.js integrity="sha256-l4rCIZsI4k5ow/Pq2o2ZrdUNnZl844YTVLYCzJT3XzA="></script></body></html>